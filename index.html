<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DSR Secondary Sales</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
  <div id="app" class="max-w-xl mx-auto p-4">
    <header class="mb-4">
      <h1 class="text-2xl font-bold">DSR Secondary Sales</h1>
      <p class="text-sm text-gray-600">Mobile Form & Admin Panel</p>
    </header>

    <nav class="mb-4 flex gap-2">
      <button id="nav-sales" class="flex-1 p-2 border rounded bg-white">Salesman Login</button>
      <button id="nav-admin" class="flex-1 p-2 border rounded bg-white">Admin Panel</button>
    </nav>

    <main id="main"></main>

    <footer class="mt-6 text-xs text-gray-500 text-center">
      Â© 2025 DSR. Local demo version.
    </footer>
  </div>

<script>
const ADMIN_USERNAME = 'csdsradmin';
const ADMIN_PASSWORD = 'Csr@dsr2500';
const SALESMAN_LOGIN = { username: 'stidsr', password: 'dsrlite1' };

function validateSalesman(u, p) {
  return u.trim().toLowerCase() === SALESMAN_LOGIN.username &&
         p.trim().toLowerCase() === SALESMAN_LOGIN.password;
}

function loadEntries(){ try { return JSON.parse(localStorage.getItem('dsr_entries')||'[]') }catch(e){ return [] } }
function saveEntries(arr){ localStorage.setItem('dsr_entries', JSON.stringify(arr)) }
function gradeFromCottons(n){ n = Number(n)||0; if(n>=10) return 'A'; if(n>=5) return 'B'; if(n>=1) return 'C'; return 'N/A'; }
function downloadCSV(filename, rows){
  if(rows.length===0) return;
  const header = Object.keys(rows[0]).join(',') + '\n';
  const body = rows.map(r => Object.values(r).map(v => `"${String(v).replace(/"/g, '""')}"`).join(',')).join('\n');
  const blob = new Blob([header + body], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = filename;
  document.body.appendChild(a); a.click();
  a.remove(); URL.revokeObjectURL(url);
}

const main = document.getElementById('main');

function renderSalesLogin() {
  main.innerHTML = `
  <section class="bg-white p-4 rounded shadow-sm">
    <h2 class="font-semibold mb-2">Salesman Login</h2>
    <form id="sales-login" class="space-y-3">
      <div>
        <label class="text-xs">Executive Login Name</label>
        <input id="sales-user" required class="w-full border rounded p-2" placeholder="Enter your login name">
      </div>
      <div>
        <label class="text-xs">Access Code</label>
        <input id="sales-pass" type="password" required class="w-full border rounded p-2" placeholder="Enter access code">
      </div>
      <button type="submit" class="w-full bg-blue-600 text-white rounded p-2">Login</button>
    </form>
  </section>`;
  
  document.getElementById('sales-login').onsubmit = e => {
    e.preventDefault();
    const u = document.getElementById('sales-user').value;
    const p = document.getElementById('sales-pass').value;
    if (validateSalesman(u, p)) renderSalesForm();
    else alert('Invalid login. Please check your details.');
  }
}

function renderSalesForm() {
  const items = [
    'TASTY GOLD NATURAL GN',
    'TASTY GOLD LITE SFR',
    'TASTY GOLD RICH RBR',
    'TASTY GOLD GN MULTI SOURCE',
    'DEEPAM OIL'
  ];
  main.innerHTML = `
  <section class="bg-white p-4 rounded shadow-sm">
    <h2 class="font-semibold mb-2">Outlet Sales Form</h2>
    <form id="sales-form" class="space-y-3">
      <div>
        <label class="text-xs">Date</label>
        <input id="fld-date" type="date" required class="w-full border rounded p-2">
      </div>
      <div>
        <label class="text-xs">Executive Name</label>
        <input id="fld-exec" required class="w-full border rounded p-2" placeholder="Type your name">
      </div>
      <div>
        <label class="text-xs">Distributor Name</label>
        <input id="fld-distributor" class="w-full border rounded p-2">
      </div>
      <div class="grid grid-cols-2 gap-2">
        <div>
          <label class="text-xs">District</label>
          <input id="fld-district" class="w-full border rounded p-2">
        </div>
        <div>
          <label class="text-xs">Beat Location</label>
          <input id="fld-beat" class="w-full border rounded p-2">
        </div>
      </div>
      <div>
        <label class="text-xs">Outlet Name</label>
        <input id="fld-outlet" class="w-full border rounded p-2">
      </div>
      <div>
        <label class="text-xs">Outlet Proprietor Name</label>
        <input id="fld-prop" class="w-full border rounded p-2">
      </div>
      <div>
        <label class="text-xs">WhatsApp Number</label>
        <input id="fld-whatsapp" class="w-full border rounded p-2" inputmode="tel">
      </div>
      <div>
        <label class="text-xs">Running Items (select multiple)</label>
        <div id="items-list" class="grid grid-cols-1 gap-2 mt-1"></div>
      </div>
      <div class="grid grid-cols-2 gap-2">
        <div>
          <label class="text-xs">Cottons</label>
          <input id="fld-cottons" type="number" min="0" class="w-full border rounded p-2">
        </div>
        <div>
          <label class="text-xs">Grade</label>
          <input id="fld-grade" readonly class="w-full border rounded p-2 bg-gray-100">
        </div>
      </div>
      <div>
        <label class="text-xs">Remarks</label>
        <textarea id="fld-remarks" rows="2" class="w-full border rounded p-2"></textarea>
      </div>
      <button type="submit" class="w-full bg-green-600 text-white rounded p-2">Submit</button>
    </form>
  </section>`;

  document.getElementById('items-list').innerHTML = 
    items.map(i => `<label class="flex items-center gap-2">
      <input type="checkbox" value="${i}" class="item"> <span class="text-sm">${i}</span>
    </label>`).join('');

  const cottons = document.getElementById('fld-cottons');
  const grade = document.getElementById('fld-grade');
  cottons.oninput = () => grade.value = gradeFromCottons(cottons.value);

  document.getElementById('sales-form').onsubmit = e => {
    e.preventDefault();
    const data = {
      date: document.getElementById('fld-date').value,
      executive: document.getElementById('fld-exec').value,
      distributor: document.getElementById('fld-distributor').value,
      district: document.getElementById('fld-district').value,
      beat: document.getElementById('fld-beat').value,
      outlet: document.getElementById('fld-outlet').value,
      proprietor: document.getElementById('fld-prop').value,
      whatsapp: document.getElementById('fld-whatsapp').value,
      items: Array.from(document.querySelectorAll('.item:checked')).map(i=>i.value).join('; '),
      cottons: document.getElementById('fld-cottons').value,
      grade: grade.value,
      remarks: document.getElementById('fld-remarks').value,
      submitted_at: new Date().toLocaleString()
    };
    const entries = loadEntries();
    entries.unshift(data);
    saveEntries(entries);
    alert('Submitted successfully!');
    e.target.reset();
    grade.value = '';
  };
}

function renderAdminLogin() {
  main.innerHTML = `
  <section class="bg-white p-4 rounded shadow-sm">
    <h2 class="font-semibold mb-2">Admin Login</h2>
    <form id="admin-login" class="space-y-3">
      <div>
        <label class="text-xs">Username</label>
        <input id="admin-user" required class="w-full border rounded p-2">
      </div>
      <div>
        <label class="text-xs">Password</label>
        <input id="admin-pass" type="password" required class="w-full border rounded p-2">
      </div>
      <button type="submit" class="w-full bg-indigo-600 text-white rounded p-2">Login</button>
    </form>
  </section>`;
  document.getElementById('admin-login').onsubmit = e => {
    e.preventDefault();
    const u = document.getElementById('admin-user').value;
    const p = document.getElementById('admin-pass').value;
    if (u === ADMIN_USERNAME && p === ADMIN_PASSWORD) renderAdminPanel();
    else alert('Invalid admin credentials');
  };
}

function renderAdminPanel() {
  const entries = loadEntries();
  main.innerHTML = `
  <section class="bg-white p-4 rounded shadow-sm space-y-3">
    <h2 class="font-semibold">Admin Panel</h2>
    <div class="grid grid-cols-2 gap-2">
      <button id="refresh" class="p-2 border rounded">Refresh</button>
      <button id="export" class="p-2 border rounded">Export CSV</button>
    </div>
    <div id="data" class="mt-2 text-sm"></div>
  </section>`;

  function draw() {
    const arr = loadEntries();
    const el = document.getElementById('data');
    if (arr.length === 0) {
      el.innerHTML = '<div class="text-gray-500">No submissions yet</div>';
      return;
    }
    el.innerHTML = `
    <div class="overflow-auto max-h-96">
      <table class="w-full text-xs border-collapse">
        <thead class="bg-gray-100 sticky top-0">
          <tr>${Object.keys(arr[0]).map(k=>`<th class='border p-1 text-left'>${k}</th>`).join('')}</tr>
        </thead>
        <tbody>
          ${arr.map(r => `<tr>${Object.values(r).map(v => `<td class='border p-1'>${v}</td>`).join('')}</tr>`).join('')}
        </tbody>
      </table>
    </div>`;
  }
  draw();
  document.getElementById('refresh').onclick = draw;
  document.getElementById('export').onclick = () => {
    const arr = loadEntries();
    if (arr.length === 0) return alert('No data to export');
    downloadCSV('dsr_export.csv', arr);
  };
}

document.getElementById('nav-sales').onclick = renderSalesLogin;
document.getElementById('nav-admin').onclick = renderAdminLogin;
renderSalesLogin();
</script>
</body>
</html>
